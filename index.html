<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Threaded insert calculator</title>

<style>

    input[type="range"] {
        border: 5px solid red;
        min-width: 50em;
    }


</style>

</head>

<script>

//  Everything is in millimeters
data = {

    "pla": {

        //  Multiplier to get hole size from insert size
        adjustment: 0.93,
    
        //  Hole shrinkage, by diameter, in millimeters
        shrinkage: [
            // hole size minimum, hole size maximum, shrinkage at minimum size, shrinkage at maximum size
            [0, 6, -0.15, -0.30],
            [6, 12, -0.20, -0.40],
            [12, 20, -0.10, 0.00]
        ]
    },

    "plaplus": {
        adjustment: 0.94,
        shrinkage: [
            [0, 6,  -0.12, -0.25],
            [6, 12, -0.18, -0.35],
            [12, 20, -0.08, 0.00]
        ]
    },

    "petg": {
        adjustment: 0.92,
        shrinkage: [
            [0, 6,  -0.15, -0.30],
            [6, 12, -0.20, -0.40],
            [12, 20, -0.10, 0.00]
        ]
    },

    "pet": {
        adjustment: 0.94,
        shrinkage: [
            [0, 6,  -0.10, -0.25],
            [6, 12, -0.15, -0.30],
            [12, 20, -0.05, 0.00]
        ]
    },

    "abs": {
        adjustment: 0.90,
        shrinkage: [
            [0, 6,  -0.20, -0.40],
            [6, 12, -0.30, -0.50],
            [12, 20, -0.20, -0.10]
        ]
    },

    "asa": {
        adjustment: 0.91,
        shrinkage: [
            [0, 6,  -0.18, -0.35],
            [6, 12, -0.25, -0.45],
            [12, 20, -0.15, -0.05]
        ]
    },

    "pc": {
        adjustment: 0.95,
        shrinkage: [
            [0, 6,  -0.10, -0.20],
            [6, 12, -0.15, -0.30],
            [12, 20, -0.05, 0.00]
        ]
    },

    "pcabs": {
        adjustment: 0.93,
        shrinkage: [
            [0, 6,  -0.15, -0.30],
            [6, 12, -0.20, -0.40],
            [12, 20, -0.10, 0.00]
        ]
    },

    "nylon": {
        adjustment: 0.90,
        shrinkage: [
            [0, 6,  -0.25, -0.50],
            [6, 12, -0.35, -0.60],
            [12, 20, -0.25, -0.15]
        ]
    },

    "nyloncfgf": {
        adjustment: 0.96,
        shrinkage: [
            [0, 6,  -0.05, -0.15],
            [6, 12, -0.08, -0.20],
            [12, 20, -0.05, 0.00]
        ]
    },

    "tpu": {
        adjustment: 0.97,
        shrinkage: [
            [0, 6,  -0.05, -0.15],
            [6, 12, -0.08, -0.20],
            [12, 20, -0.05, 0.00]
        ]
    }
}

function showResult(value) {
    document.getElementById('result').value = value;
}

function calculate() {
    const fil = document.getElementById('filament').value;
    const value = Number(document.getElementById('od').value);

    if (isNaN(value) || !data.hasOwnProperty(fil))
        return showResult('ERROR');

    let result = value;

    //  Adjust hole diameter to shrinkage
    for (x of data[fil].shrinkage) {

        let min = x[0];
        let max = x[1];
        let s_min = x[2];
        let s_max = x[3];

        if (value >= min && value <= max) {
            const np = (value - min) / (max - min);
            result += (s_min + (s_max - s_min) * np);
            break;
        }
    }

    result *= data[fil].adjustment;
    showResult(result.toFixed(2));
}


function od_input(value) {
    document.getElementById('od_value').innerHTML = String(value);
}

</script>

<body>

    <h1>Threaded insert calculator</h1>

    <p>
        This simple calculator estimates the optimal diameter of a hole for a threaded heat insert for a 3D printed element, taking warping into account.
    </p>

    <label for="filament">Filament type:<br /></label>
    <select id="filament" onchange="calculate()">
        <option value="pla">PLA</option>
        <option value="plaplus">PLA+</option>
        <option value="pet">PET</option>
        <option value="petg">PETG</option>
        <option value="abs">ABS</option>
        <option value="asa">ASA</option>
        <option value="pc">PC</option>
        <option value="pcabs">PC-ABS</option>
        <option value="nylon">Nylon (PA)</option>
        <option value="nyloncfgf">Nylon CF/GF</option>
        <option value="tpu">TPU</option>
    </select>
    <br /><br />

    <label for="od">Outer diameter of the threaded insert (mm):<br /></label>
    <input type="range" id="od" decimals="2" min="1" max="20" value="4.00" step="0.1" oninput="od_input(this.value)" onchange="calculate()" />
    <span id="od_value">4.00</span>
    <br /><br />

    <label for="hole">Optimal hole diameter, mm:<br /></label>
    <input type="text" disabled value="0" id="result" />

    
</body>
</html>

