<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Threaded insert calculator</title>
    <link rel="stylesheet" href="style.css">

</head>

<script src="./data.js"></script>
<script>

function showResult(value) {
    document.getElementById('result').value = value;
}

function calculate() {
    const fil = document.getElementById('filament').value;
    const value = Number(document.getElementById('od').value);

    if (isNaN(value) || !filaments.hasOwnProperty(fil))
        return showResult('ERROR');

    let result = value;
    let passthrough = value;

    //  Adjust hole diameter to shrinkage
    for (x of filaments[fil].shrinkage) {

        let min = x[0];
        let max = x[1];
        let s_min = x[2];
        let s_max = x[3];

        if (value >= min && value <= max) {
            const np = (value - min) / (max - min);
            result += (s_min + (s_max - s_min) * np);
            break;
        }
    }

    passthrough *= 1 + (1 - filaments[fil].adjustment);
    document.getElementById('passthrough').innerHTML = passthrough.toFixed(2);

    result *= filaments[fil].adjustment;
    document.getElementById('result').innerHTML = result.toFixed(2);

    document.getElementById('diff').innerHTML = Math.abs(passthrough - result).toFixed(2);

}


function od_input(value) {
    document.getElementById('od_value').innerHTML = String(value);
}

</script>

<body>
    <a href="./bolts.html">Bolt passthrough calculator</a>

    <h1>Threaded insert calculator</h1>

    <p>
        This simple calculator estimates the optimal diameter of a hole for a threaded heat insert for a 3D printed element, taking warping into account.
    </p>

    <label for="filament">Filament type:<br /></label>
    <select id="filament" onchange="calculate()"></select>
    <br /><br />

    <label for="od">Outer diameter of the threaded insert (mm):<br /></label>
    <input type="range" id="od" decimals="2" min="1" max="20" value="0" step="0.1" oninput="od_input(this.value)" onchange="calculate()" />
    <span id="od_value">0</span>
    <br /><br />

    <table>
    <thead>
      <tr>
           <th>Optimal diameter</th>
           <th>Passthrough</th>
           <th>Difference</th>
      </tr>
    </thead>

    <tbody>
      <tr>
          <td id="result">0</td>
          <td id="passthrough">0</td>
          <td id="diff">0</td>
      </tr>

    </tbody>

    </table>

</body>
</html>

